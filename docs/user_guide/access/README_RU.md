---
title: "Модуль user-authn"
search: kube config generator
webIfaces:
- name: kubeconfig
  urlInfo: faq.html#как-я-могу-сгенерировать-kubeconfig-для-доступа-к-kubernetes-api
---

Модуль настраивает единую систему аутентификации, интегрированную с Kubernetes и веб-интерфейсами, используемыми в других модулях (Grafana, Dashboard и др.).

Модуль состоит из следующих компонентов:
- [dex](https://github.com/dexidp/dex) — федеративный OpenID Connect провайдер, который обеспечивает работу со статическими пользователями и может быть подключен к одному или нескольким внешним провайдерам аутентификации (например, он поддерживает SAML, Gitlab и Github);
- kubeconfig-generator (на самом деле [dex-k8s-authenticator](https://github.com/mintel/dex-k8s-authenticator)) — веб-приложение, которое после авторизации в Dex генерирует команды для настройки локального kubectl;
- dex-authenticator (на самом деле [oauth2-proxy](https://github.com/oauth2-proxy/oauth2-proxy)) — приложение, которое принимает запросы от NGINX Ingress (auth_request) и производит их аутентификацию в Dex.

Управление статическими пользователями осуществляется с помощью custom resource [User](cr.html#user), в котором содержится вся информация о пользователе, включая пароль.

Поддерживаются следующие внешние провайдеры/протоколы аутентификации:
- Github;
- Gitlab;
- BitBucket Cloud;
- Crowd;
- LDAP;
- OIDC.

Одновременно можно подключить более одного внешнего провайдера аутентификации.

## Возможности интеграции

### Возможность аутентификации в API Kubernetes по логину и паролю

Аутентификация по логину и паролю в API Kubernetes сейчас доступна **только** для провайдера *Crowd*.
В ближайшее время ожидается появление поддержки этой возможности для статических пользователей и провайдеров с поддержкой LDAP.

## Расширения от «Фланта»

Модуль использует модифицированную версию Dex, которая содержит следующий дополненный и исправленный функционал:
- поддержка групп для статических пользователей и для провайдера Bitbucket Cloud;
- поддержка передачи параметра group клиентам;
- поддержка механизма `obsolete tokens`, который позволяет избежать состояния гонки при продлении токена OIDC-клиентом.

## Отказоустойчивый режим

Модуль также поддерживает режим `highAvailability`. При его включении аутентификаторы — элементы, которые отвечают на `auth request`-запросы, — будут развернуты с учетом избыточности, необходимой для обеспечения бесперебойной работы. В случае сбоя любого из экземпляров аутентификаторов пользовательские сессии аутентификации не обрываются.
