image: {{ .ModuleName }}/{{ .ImageName }}
fromImage: common/shell-operator
import:
  - artifact: {{ $.ModuleName }}/{{ $.ImageName }}-artifact
    add: /
    to: /
    includePaths:
      - usr/local/lib/python3
      - usr/local/lib64/python3
    before: setup
git:
  - add: /{{ $.ModulePath }}modules/300-{{ $.ModuleName }}/images/{{ $.ImageName }}/hooks
    to: /hooks
    stageDependencies:
      install:
        - '**/*'
shell:
  beforeInstall:
    - apt-get update
    - apt-get install -y python3
    - rm -rf /var/cache/apt /var/lib/apt /var/lib/rpm
---
artifact: {{ $.ModuleName }}/{{ $.ImageName }}-artifact
fromImage: common/alt
git:
  - add: /{{ $.ModulePath }}modules/300-{{ $.ModuleName }}/images/{{ $.ImageName }}/requirements.txt
    to: /tmp/requirements.txt
    stageDependencies:
      install:
        - '**/*'
shell:
  beforeInstall:
    - apt-get update
    - apt-get install -y python3 pip git
  install:
    - export SOURCE_REPO={{ .SOURCE_REPO }}
    - pip3 install -r /tmp/requirements.txt
