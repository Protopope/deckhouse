---
title: "Модуль deckhouse"
search: releaseChannel, стабилизация релизного канала, автосмена канала обновлений
---

Этот модуль настраивает в Deckhouse:
- **[Уровень логирования](configuration.html#parameters-loglevel)**
- **[Набор модулей](configuration.html#parameters-bundle), включенных по умолчанию**

  Обычно используется набор модулей `Default`, который подходит в большинстве случаев.

  Независимо от используемого набора включенных по умолчанию модулей любой модуль может быть явно включен или выключен в конфигурации Deckhouse (подробнее [про включение и отключение модуля](../../#включение-и-отключение-модуля)).
- **[Канал обновлений](configuration.html#parameters-releasechannel)**

  В Deckhouse реализован механизм автоматического обновления. Этот механизм использует [5 каналов обновлений](../../deckhouse-release-channels.html), различающиеся стабильностью и частотой выхода версий. Ознакомьтесь подробнее с тем, [как работает механизм автоматического обновления](../../deckhouse-faq.html#как-работает-автоматическое-обновление-deckhouse) и [как установить желаемый канал обновлений](../../deckhouse-faq.html#как-установить-желаемый-канал-обновлений).
- **[Режим обновлений](configuration.html#parameters-update-mode)** и **[окна обновлений](configuration.html#parameters-update-windows)**

  Deckhouse может использовать **ручной** или **автоматический** режим обновлений.

  В ручном режиме обновлений автоматически применяются только важные исправления (patch-релизы), и для перехода на новый релиз Deckhouse требуется [ручное подтверждение](cr.html#deckhouserelease-v1alpha1-approved).

  В автоматическом режиме обновлений, если в кластере **не установлены** [окна обновлений](configuration.html#parameters-update-windows), переход на более свежий релиз Deckhouse осуществляется сразу после его появления на соответствующем канале обновлений. Если же в кластере **установлены** окна обновлений, переход на более свежий релиз Deckhouse начнется в ближайшее доступное окно обновлений после появления свежего релиза на соответствующем канале обновлений.
  
- **Сервис валидирования custom resource'ов**

  Сервис валидирования предотвращает создание custom resource'ов с некорректными данными или внесение таких данных в уже существующие custom resource'ы. Отслеживаются только custom resource'ы, находящиеся под управлением модулей Deckhouse.

### Обновление релизов Deckhouse

#### Просмотр статуса релизов Deckhouse

Список предыдущих релизов в кластере можно получить командной `kubectl get deckhousereleases`. По умолчанию хранятся 10 предыдущих релизов и все последующие.

Каждый релиз может иметь один из следующих статусов:
* `Pending` — релиз находится в ожидании, ждет окна обновления, настроек канареечного развертывания и т. д. Подробности можно увидеть с помощью команды `kubectl describe deckhouserelease $name`.
* `Deployed` — релиз применен. Это значит, что образ пода Deckhouse уже поменялся на новую версию,
 но при этом процесс обновления всех компонентов кластера идет асинхронно, так как зависит от многих настроек.
* `Superseded` — релиз устарел и больше не используется.
* `Suspended` — релиз отменен (например, в нем обнаружилась ошибка). Релиз переходит в этот статус, если его отменили и при этом он еще был применен в кластере.

#### Процесс обновления

В момент перехода в статус `Deployed` релиз меняет версию (tag) образа Deckhouse. После запуска Deckhouse начнет проверку и обновление всех модулей, которые поменялись с предыдущего релиза. 

Время зависит от нагрузки на интресс-контроллеры или количества узлов в кластере.
Например, если содержится множество `NodeGroup`, они могут обновляться продолжительное время, если множество `IngressNginxController` — контроллеры будут обновляться по одному и это тоже займет некоторое время.

#### Ручное применение релизов

Если выбран [ручной режим обновления](usage.html#ручное-подтверждение-обновлений) и скопилось несколько релизов,
их можно сразу одобрить к применению. В этом случае Deckhouse будет обновляться последовательно, сохраняя порядок релизов и меняя статус каждого примененного релиза.

#### *Закрепление* релиза

*Закрепление* релиза нужно, если по какой-то причине не нужно обновлять Deckhouse.

Существует три варианта *закрепления* релиза:
1. Выставление [ручного режима обновления](usage.html#ручное-подтверждение-обновлений).
В этом случае вы остановитесь на текущем релизе, но будете получать patch-релизы, а minor-релиз не будет обновляться без одобрения.
  
  Например:
    текущий релиз `v1.29.3`, после установки ручного режима обновлений Deckhouse, сможет обновиться до версии `v1.29.9`, но не будет обновляться на релиз `v1.30.0`.

2. Установка конкретного тега для deployment/deckhouse. В таком случае Deckhouse останется на этом релизе до выхода следующего patch/minor-релиза.

   Такое может потребоваться, если в новой версии Deckhouse была обнаружена ошибка, которую не удавалось заметить в предыдущих версиях. В этом случае необходимо вернуться на предыдущий релиз. После этого нужно обновить систему, как только станет доступен релиз с исправлением этой ошибки.

  Например:
    `kubectl -n d8-system set image deployment/deckhouse deckhouse=registry.deckhouse.io/deckhouse/ee:v1.30.5`.

3. Установка конкретного тега для deployment/deckhouse и удаление `releaseChannel` из конфигурации модуля `deckhouse`.

   В этом случае вы останетесь на конкретной версии Deckhouse и не будете получать обновлений.

   ```sh
   $ kubectl -n d8-system set image deployment/deckhouse deckhouse=registry.deckhouse.io/deckhouse/ee:v1.30.5
   $ kubectl edit mc deckhouse
     // удалить releaseChannel
   ```
